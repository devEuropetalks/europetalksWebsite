name: Export Translations

on:
  # Führe den Export wöchentlich aus
  schedule:
    - cron: '0 0 * * 0'  # Jeden Sonntag um Mitternacht
  
  # Erlaube manuelle Auslösung
  workflow_dispatch:
  
  # Optional: Exportiere nach jedem Push in den main-Branch
  # push:
  #   branches: [main]

jobs:
  export:
    runs-on: ubuntu-latest
    
    steps:
      - name: Call Export API
        id: export
        uses: fjogeleit/http-request-action@v1
        with:
          url: '${{ secrets.APP_URL }}/api/translations/export'
          method: 'POST'
          customHeaders: '{"x-api-key": "${{ secrets.TRANSLATIONS_EXPORT_API_KEY }}"}'
      
      - name: Log result
        run: |
          echo "Status: ${{ steps.export.outputs.status }}"
          echo "Response: ${{ steps.export.outputs.response }}"
      
      - name: Checkout repository
        uses: actions/checkout@v3
        
      - name: Configure Git
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          
      - name: Fetch latest changes
        run: git pull
          
      - name: Check for changes
        id: check_changes
        run: |
          if [[ -n $(git status --porcelain) ]]; then
            echo "::set-output name=changes_exist::true"
          else
            echo "::set-output name=changes_exist::false"
          fi
          
      - name: Commit changes
        if: steps.check_changes.outputs.changes_exist == 'true'
        run: |
          git add translations/*.json
          git commit -m "Auto-update translation JSON files"
          git push 